<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lista de Contatos</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body onload="carregarContatos()">

<div class="container mt-5">
    <h1 class="mb-4">Contatos Recebidos</h1>

    <table class="table table-striped">
        <thead class="table-primary">
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Mensagem</th>
                <th>Data</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="tabela-contatos"></tbody>
    </table>
</div>

<script>
async function carregarContatos() {

    let resposta = await fetch("./back-php/contato-listar.php");
    let dados = await resposta.json();

    let tabela = document.getElementById("tabela-contatos");
    tabela.innerHTML = ""; // limpa antes de preencher

    for (let item of dados) {

        // Corrige data
        let dataEnvio = item.data_envio ?? "";
        if (dataEnvio !== "") {
            let d = new Date(dataEnvio);
            dataEnvio = d.toLocaleString("pt-BR");
        }

        tabela.innerHTML += `
            <tr>
                <td>${item.id}</td>
                <td>${item.nome}</td>
                <td>${item.email}</td>
                <td>${item.mensagem}</td>
                <td>${dataEnvio}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="excluirContato(${item.id})">
                        Excluir
                    </button>
                </td>
            </tr>
        `;
    }
}

async function excluirContato(id) {
    if (!confirm("Deseja excluir este contato?")) return;

    let resposta = await fetch("./back-php/contato-excluir.php?id=" + id);
    let dados = await resposta.text();
    console.log(dados);

    alert("Contato excluído!");
    carregarContatos();
}
</script>

</body>
</html>
